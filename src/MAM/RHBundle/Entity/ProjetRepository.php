<?php

namespace MAM\RHBundle\Entity;

use DateTime;
use Doctrine\ORM\EntityRepository;
use MAM\UserBundle\Entity\User;

/**
 * ProjetRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ProjetRepository extends EntityRepository
{

    public function getnbrprojet(User $user){
        $nbrproj = $this->createQueryBuilder('d')
            ->select('COUNT(DISTINCT d.id)')
            ->where('d.Date_fin < :d')
            ->leftJoin('d.employeNormals','e')
            ->leftJoin('e.user','u')
            ->andwhere('u.id = :user')
            ->setParameter('d', new Datetime())
            ->setParameter('user', $user->getId())
            ->getQuery()
            ->getResult();
        return $nbrproj;
    }

    public function getnbrprojetchef(User $user){
        $nbrproj = $this->createQueryBuilder('d')
            ->select('COUNT(DISTINCT d.id)')
            ->where('d.Date_fin < :d')
            ->leftJoin('d.chefProjet','e')
            ->leftJoin('e.user','u')
            ->andwhere('u.id = :user')
            ->setParameter('d', new Datetime())
            ->setParameter('user', $user->getId())
            ->getQuery()
            ->getResult();
        return $nbrproj;
    }



    public function getnbrprojetdep(User $user){
        $nbrproj = $this->createQueryBuilder('d')
            ->select('COUNT(DISTINCT d.id)')
            ->where('d.Date_fin < :d')
            ->leftJoin('d.chefDepartement','e')
            ->leftJoin('e.user','u')
            ->andwhere('u.id = :user')
            ->setParameter('d', new Datetime())
            ->setParameter('user', $user->getId())
            ->getQuery()
            ->getResult();
        return $nbrproj;
    }

    public function getprojetdep(User $user){
        $projets = $this->createQueryBuilder('p')
            ->leftJoin('p.chefDepartement','c')
            ->addSelect('c')
            ->leftJoin('c.user','u')
            ->where('u.id = :i')
            ->setParameter('i', $user->getId())
            ->getQuery()
            ->getResult();

        return $projets;
    }

    public function getprojetchefp(User $user){
        $projets = $this->createQueryBuilder('p')
            ->leftJoin('p.chefProjet','c')
            ->addSelect('c')
            ->leftJoin('c.user','u')
            ->where('u.id = :i')
            ->setParameter('i', $user->getId())
            ->getQuery()
            ->getResult();

        return $projets;
    }

    public function getprojetchefpA(User $user){

        $projets = $this->createQueryBuilder('p')
            ->Where('p.Date_fin > :d')
            ->leftJoin('p.chefProjet','c')
            ->addSelect('c')
            ->leftJoin('c.user','u')
            ->andWhere('u.id = :i')
            ->setParameter('d', new Datetime())
            ->setParameter('i', $user->getId())
            ->getQuery()
            ->getResult();

        return $projets;
    }
}
